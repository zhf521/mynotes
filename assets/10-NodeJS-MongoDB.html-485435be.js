import{_ as e,r as o,o as c,c as l,d as n,e as s,a as t,b as p}from"./app-03fcb806.js";const i={},u=n("h2",{id:"_1-简介",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-简介","aria-hidden":"true"},"#"),s(" 1. 简介")],-1),r=n("h3",{id:"_1-1-mongodb是什么",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1-1-mongodb是什么","aria-hidden":"true"},"#"),s(" 1.1 Mongodb是什么")],-1),d={href:"https://www.mongodb.com",target:"_blank",rel:"noopener noreferrer"},k=p(`<h3 id="_1-2-数据库是什么" tabindex="-1"><a class="header-anchor" href="#_1-2-数据库是什么" aria-hidden="true">#</a> 1.2 数据库是什么</h3><p>数据库（DataBase）是按照数据结构来组织、存储和管理数据的应用程序</p><h3 id="_1-3-数据库的作用" tabindex="-1"><a class="header-anchor" href="#_1-3-数据库的作用" aria-hidden="true">#</a> 1.3 数据库的作用</h3><p>数据库的主要作用就是管理数据，对数据进行增（c）、删（d）、改（u）、查（r）</p><h3 id="_1-4-数据库管理数据的特点" tabindex="-1"><a class="header-anchor" href="#_1-4-数据库管理数据的特点" aria-hidden="true">#</a> 1.4 数据库管理数据的特点</h3><p>相比于纯文件管理数据，数据库管理数据有如下特点：</p><ol><li>速度更快</li><li>扩展性更强</li><li>安全性更强</li></ol><h3 id="_1-5-为什么选择mongodb" tabindex="-1"><a class="header-anchor" href="#_1-5-为什么选择mongodb" aria-hidden="true">#</a> 1.5 为什么选择Mongodb</h3><p>操作语法与 JavaScript 类似，容易上手，学习成本低</p><h2 id="_2-核心概念" tabindex="-1"><a class="header-anchor" href="#_2-核心概念" aria-hidden="true">#</a> 2. 核心概念</h2><p>Mongodb 中有三个重要概念需要掌握：</p><ul><li>数据库（database）：数据库是一个数据仓库，数据库服务下可以创建很多数据库，数据库中可以存放很多集合</li><li>集合（collection）：集合类似于 JS 中的数组，在集合中可以存放很多文档</li><li>文档（document）：文档是数据库中的最小单位，类似于 JS 中的对象</li></ul><p>JSON 文件示例：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;accounts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  	<span class="token punctuation">{</span>
		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3-YLju5f3&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;买电脑&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-02-08&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;-1&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;account&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5500&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;remarks&quot;</span><span class="token operator">:</span> <span class="token string">&quot;为了上网课&quot;</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
  	<span class="token punctuation">{</span>
  		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3-YLju5f4&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请女朋友吃饭&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-02-08&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;-1&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;account&quot;</span><span class="token operator">:</span> <span class="token string">&quot;214&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;remarks&quot;</span><span class="token operator">:</span> <span class="token string">&quot;情人节聚餐&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
          <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mRQiD4s3K&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;发工资&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-02-19&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;account&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4396&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;remarks&quot;</span><span class="token operator">:</span> <span class="token string">&quot;终于发工资啦!~~&quot;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;users&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
  	<span class="token punctuation">{</span>
  		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">18</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
  	<span class="token punctuation">{</span>
  		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">20</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
  	<span class="token punctuation">{</span>
  		<span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">,</span>
  		<span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">22</span>
  	<span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大家可以通过 JSON 文件来理解 Mongodb 中的概念</p><ul><li>一个JSON文件好比是一个数据库，一个 Mongodb 服务下可以有 N 个数据库</li><li>JSON 文件中的一级属性的数组值好比是集合</li><li>数组中的对象好比是文档</li><li>对象中的属性有时也称之为字段</li></ul><blockquote><p>一般情况下：</p><ul><li>一个项目使用一个数据库</li><li>一个集合会存储同一种类型的数据</li></ul></blockquote><h2 id="_3-下载安装与启动" tabindex="-1"><a class="header-anchor" href="#_3-下载安装与启动" aria-hidden="true">#</a> 3. 下载安装与启动</h2>`,18),v={href:"https://www.mongodb.com/try/download/community",target:"_blank",rel:"noopener noreferrer"},m=p(`<p>建议选择 <code>zip</code> 类型， 通用性更强</p><p>配置步骤如下：</p><ol><li>将压缩包移动到安装目录下，然后解压</li><li>创建<code>\\data\\db</code>目录，mongodb 会将数据默认保存在这个文件夹</li><li>以 mongodb 中 bin 目录作为工作目录，启动命令行</li><li>运行命令<code>mongod --dbpath /data/db目录的路径</code></li></ol><p>看到最后的 <code>waiting for connections</code> 则表明服务已经启动成功</p><p>然后可以使用 <code>mongo</code> 命令连接本机的 mongodb 服务</p><h2 id="_4-命令行交互" tabindex="-1"><a class="header-anchor" href="#_4-命令行交互" aria-hidden="true">#</a> 4. 命令行交互</h2><p>命令行交互一般是学习数据库的第一步，不过这些命令在后续用的比较少，了解即可</p><h3 id="_4-1-数据库命令" tabindex="-1"><a class="header-anchor" href="#_4-1-数据库命令" aria-hidden="true">#</a> 4.1 数据库命令</h3><ol><li><p>显示所有的数据库</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> dbs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>切换到指定的数据库，如果数据库不存在会自动创建数据库</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> 数据库名
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>显示当前所在的数据库</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>删除当前数据库</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> 库名
db<span class="token punctuation">.</span>dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="_4-2-集合命令" tabindex="-1"><a class="header-anchor" href="#_4-2-集合命令" aria-hidden="true">#</a> 4.2 集合命令</h3><ol><li><p>创建集合</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>createCollection<span class="token punctuation">(</span><span class="token string">&#39;集合名称&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>显示当前数据库中的所有集合</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">show</span> collections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>删除某个集合</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token keyword">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>重命名集合</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span>renameCollection<span class="token punctuation">(</span><span class="token string">&#39;newName&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h3 id="_4-3-文档命令" tabindex="-1"><a class="header-anchor" href="#_4-3-文档命令" aria-hidden="true">#</a> 4.3 文档命令</h3><ol><li><p>插入文档</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>文档对象<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>查询文档</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>查询条件<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>_id</code> 是 mongodb 自动生成的唯一编号，用来唯一标识文档</p></li><li><p>更新文档</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>查询条件<span class="token punctuation">,</span>新的文档<span class="token punctuation">)</span>
db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{name:<span class="token string">&#39;张三&#39;</span>}<span class="token punctuation">,</span>{$<span class="token keyword">set</span>:{age:<span class="token number">19</span>}}<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>删除文档</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>查询条件<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="_5-mongoose" tabindex="-1"><a class="header-anchor" href="#_5-mongoose" aria-hidden="true">#</a> 5. Mongoose</h2>`,14),b={href:"http://www.mongoosejs.net/",target:"_blank",rel:"noopener noreferrer"},g=p(`<h3 id="_5-1-作用" tabindex="-1"><a class="header-anchor" href="#_5-1-作用" aria-hidden="true">#</a> 5.1 作用</h3><p>方便使用代码操作 mongodb 数据库</p><h3 id="_5-2-使用流程" tabindex="-1"><a class="header-anchor" href="#_5-2-使用流程" aria-hidden="true">#</a> 5.2 使用流程</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token comment">//1. 安装 mongoose：npm i mongoose</span>
 <span class="token comment">//2. 导入 mongoose</span>
 <span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span>

 <span class="token comment">//3. 连接数据库                              </span>
 mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1:27017/bilibili&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 这里的bilibili是数据库的名称</span>

 <span class="token comment">//4. 设置连接回调</span>
 <span class="token comment">//连接成功   once 一次   事件回调函数只执行一次</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接成功&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token comment">//5. 创建文档结构对象</span>
    <span class="token comment">// 设置集合中文档的属性以及属性值得类型</span>
 	<span class="token keyword">let</span> BookSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 		<span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
 		<span class="token literal-property property">author</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
 		<span class="token literal-property property">price</span><span class="token operator">:</span> Number
 	<span class="token punctuation">}</span><span class="token punctuation">)</span>
     
 	<span class="token comment">//6. 创建文档模型对象  对文档操作的封装对象  mongoose会使用集合名称的复数，创建集合</span>
 	<span class="token keyword">let</span> BookModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;book&#39;</span><span class="token punctuation">,</span> BookSchema<span class="token punctuation">)</span>
	
     <span class="token comment">//7. 插入文档</span>
 	BookModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;西游记&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;吴承恩&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">price</span><span class="token operator">:</span><span class="token number">19.9</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 8. 断开连接 关闭数据连接（项目运行过程中，不会添加该代码）</span>
    mongoose<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接成功&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//连接出错</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接出错~~&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//连接关闭</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;close&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;连接关闭&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-字段类型" tabindex="-1"><a class="header-anchor" href="#_5-3-字段类型" aria-hidden="true">#</a> 5.3 字段类型</h3><p>文档结构可选的常用字段类型列表</p><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>String</td><td>字符串</td></tr><tr><td>Number</td><td>数字</td></tr><tr><td>Boolean</td><td>布尔值</td></tr><tr><td>Array</td><td>数组，也可以使用 <code>[]</code> 来标识</td></tr><tr><td>Date</td><td>日期</td></tr><tr><td>Buffer</td><td>Buffer 对象</td></tr><tr><td>Mixed</td><td>任意类型，需要使用 <code>mongoose.Schema.Types.Mixed</code> 指定</td></tr><tr><td>ObjectId</td><td>对象 ID，需要使用 <code>mongoose.Schema.Types.ObjectId</code> 指定</td></tr><tr><td>Decimal128</td><td>高精度数字，需要使用 <code>mongoose.Schema.Types.Decimal128</code> 指定</td></tr></tbody></table><h3 id="_5-4-字段值验证" tabindex="-1"><a class="header-anchor" href="#_5-4-字段值验证" aria-hidden="true">#</a> 5.4 字段值验证</h3><p>Mongoose 有一些内建验证器，可以对字段值进行验证</p><ul><li><p>必填项</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
 	<span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 设置必填项</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>默认值</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token punctuation">{</span>
 	<span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
 	<span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;匿名&#39;</span> <span class="token comment">//默认值</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>枚举值</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
	<span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;女&#39;</span><span class="token punctuation">]</span> <span class="token comment">//设置的值必须是数组中的</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>唯一值</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
 	<span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>unique 需要 <code>重建集合</code> 才能有效果</p></blockquote></li></ul><h3 id="_5-5-crud" tabindex="-1"><a class="header-anchor" href="#_5-5-crud" aria-hidden="true">#</a> 5.5 CRUD</h3><p>数据库的基本操作包括四个，增加（create），删除（delete），修改（update），查（read）</p><h4 id="_5-5-1-增加" tabindex="-1"><a class="header-anchor" href="#_5-5-1-增加" aria-hidden="true">#</a> 5.5.1 增加</h4><p>插入一条：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">&#39;给我一首歌的时间&#39;</span><span class="token punctuation">,</span>
 	<span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;Jay&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//错误</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token comment">//插入后的数据对象</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>批量插入：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//1.引入mongoose</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span>

<span class="token comment">//2.链接mongodb数据库 connect 连接</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://127.0.0.1:27017/project&#39;</span><span class="token punctuation">)</span>

<span class="token comment">//3.设置连接的回调</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;open&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">//4.声明文档结构</span>
	<span class="token keyword">const</span> PhoneSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">brand</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span>String<span class="token punctuation">,</span>
		<span class="token literal-property property">price</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
 		<span class="token literal-property property">tags</span><span class="token operator">:</span>Array
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
 	<span class="token comment">//6.创建模型对象</span>
 	<span class="token keyword">const</span> PhoneModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;phone&#39;</span><span class="token punctuation">,</span>PhoneSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	PhoneModel<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
 		<span class="token punctuation">{</span>
 			<span class="token literal-property property">brand</span><span class="token operator">:</span><span class="token string">&#39;华为&#39;</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">&#39;灰色&#39;</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">price</span><span class="token operator">:</span><span class="token number">2399</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">tags</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;电量大&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;屏幕大&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;信号好&#39;</span><span class="token punctuation">]</span>
 		<span class="token punctuation">}</span><span class="token punctuation">,</span>
 		<span class="token punctuation">{</span>
 			<span class="token literal-property property">brand</span><span class="token operator">:</span><span class="token string">&#39;小米&#39;</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">&#39;白色&#39;</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">price</span><span class="token operator">:</span><span class="token number">2099</span><span class="token punctuation">,</span>
 			<span class="token literal-property property">tags</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&#39;电量大&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;屏幕大&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;信号好&#39;</span><span class="token punctuation">]</span>
         <span class="token punctuation">}</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;写入成功&#39;</span><span class="token punctuation">)</span>
         mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-2-删除" tabindex="-1"><a class="header-anchor" href="#_5-5-2-删除" aria-hidden="true">#</a> 5.5.2 删除</h4><p>删除一条数据：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token string">&#39;5dd65f32be6401035cb5b1ed&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
 	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;删除成功&#39;</span><span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>批量删除：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span><span class="token string">&#39;Jay&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
 	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;删除成功&#39;</span><span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-3-更新" tabindex="-1"><a class="header-anchor" href="#_5-5-3-更新" aria-hidden="true">#</a> 5.5.3 更新</h4><p>更新一条数据：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;JJ Lin&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;林俊杰&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>批量更新数据：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;Leehom Wang&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;王力宏&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-4-查询" tabindex="-1"><a class="header-anchor" href="#_5-5-4-查询" aria-hidden="true">#</a> 5.5.4 查询</h4><p>查询一条数据：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>SongModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;王力宏&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//根据 id 查询数据</span>
SongModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&#39;5dd662b5381fc316b44ce167&#39;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>批量查询数据：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//不加条件查询</span>
SongModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//加条件查询</span>
SongModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;王力宏&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-条件控制" tabindex="-1"><a class="header-anchor" href="#_5-6-条件控制" aria-hidden="true">#</a> 5.6 条件控制</h3><h4 id="_5-6-1-运算符" tabindex="-1"><a class="header-anchor" href="#_5-6-1-运算符" aria-hidden="true">#</a> 5.6.1 运算符</h4><p>在 mongodb 不能使用 <code>&gt; &lt; &gt;= &lt;= !==</code> 等运算符，需要使用替代符号</p><ul><li><code>&gt;</code>使用 <code>$gt</code></li><li><code>&lt;</code> 使用 <code>$lt</code></li><li><code>=</code> 使用 <code>$gte</code></li><li><code>&lt;=</code> 使用 <code>$lte</code></li><li><code>!==</code> 使用 <code>$ne</code></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//id号比3大的所有的记录</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$gt</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 价格小于 20 的图书</span>
BookModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败~~~&#39;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-6-2-逻辑运算" tabindex="-1"><a class="header-anchor" href="#_5-6-2-逻辑运算" aria-hidden="true">#</a> 5.6.2 逻辑运算</h4><p><code>$or</code> 逻辑或的情况</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">$or</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 曹雪芹 或者 余华的书</span>
BookModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;曹雪芹&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">&#39;余华&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败~~~&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>$and</code> 逻辑与的情况</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">$and</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 价格大于 30 且 小于 70</span>
BookModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">$and</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">70</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败~~~&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-6-3-正则匹配" tabindex="-1"><a class="header-anchor" href="#_5-6-3-正则匹配" aria-hidden="true">#</a> 5.6.3 正则匹配</h4><p>条件中可以直接使用 JS 的正则语法，通过正则可以进行模糊查询</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">imissyou</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

正则表达式，搜索书籍名称中带有 <span class="token string">&#39;三&#39;</span> 的图书
BookModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">三</span><span class="token regex-delimiter">/</span></span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败~~~&#39;</span><span class="token punctuation">)</span>
      	<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

BookModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&#39;三&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;读取失败~~~&#39;</span><span class="token punctuation">)</span>
      	<span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-个性化读取" tabindex="-1"><a class="header-anchor" href="#_5-7-个性化读取" aria-hidden="true">#</a> 5.7 个性化读取</h3><h4 id="_5-7-1-字段筛选" tabindex="-1"><a class="header-anchor" href="#_5-7-1-字段筛选" aria-hidden="true">#</a> 5.7.1 字段筛选</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//0:不要的字段</span>
<span class="token comment">//1:要的字段</span>
SongModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">title</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-7-2-数据排序" tabindex="-1"><a class="header-anchor" href="#_5-7-2-数据排序" aria-hidden="true">#</a> 5.7.2 数据排序</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// sort 排序</span>
<span class="token comment">// 1:升序</span>
<span class="token comment">// -1:倒序</span>
SongModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">hot</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-7-3-数据截取" tabindex="-1"><a class="header-anchor" href="#_5-7-3-数据截取" aria-hidden="true">#</a> 5.7.3 数据截取</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//skip 跳过   limit 限定</span>
SongModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-图形化管理工具" tabindex="-1"><a class="header-anchor" href="#_6-图形化管理工具" aria-hidden="true">#</a> 6. 图形化管理工具</h2><p>我们可以使用图形化的管理工具来对 Mongodb 进行交互，这里演示两个图形化工具</p>`,54),h={href:"https://github.com/Studio3T/robomongo/releases",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.navicat.com.cn/",target:"_blank",rel:"noopener noreferrer"};function f(q,_){const a=o("ExternalLinkIcon");return c(),l("div",null,[u,r,n("blockquote",null,[n("p",null,[s("MongoDB 是一个基于分布式文件存储的数据库，官方地址："),n("a",d,[s("MongoDB"),t(a)])])]),k,n("p",null,[s("下载地址："),n("a",v,[s("Download MongoDB Community Server"),t(a)])]),m,n("p",null,[s("Mongoose 是一个对象文档模型库，官网："),n("a",b,[s("Mongoose.js中文网 "),t(a)])]),g,n("ul",null,[n("li",null,[n("p",null,[s("Robo 3T 免费："),n("a",h,[s("Releases · Studio3T/robomongo"),t(a)])])]),n("li",null,[n("p",null,[s("Navicat 收费："),n("a",y,[s("Navicat"),t(a)])])])])])}const x=e(i,[["render",f],["__file","10-NodeJS-MongoDB.html.vue"]]);export{x as default};
